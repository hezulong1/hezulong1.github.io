---
title: 小白学 TypeScript 有感
date: 2022-02-23
layout: post
category: 随谈
---

说起 TypeScript（以下简称 TS），认识的蛮早，但是因为不喜欢强类型，所以一直排斥使用它。

但随着越来越多的程序员使用，慢慢的，我也重新审视自己，是不是太井底之蛙了？所以我又重新拾起它，一边阅读一些优秀源码，一边编写小工具来巩固下所学。总算把小工具完成了，我也谈下对比 JS，使用 TS 给我这个小白的感受。

首先是环境搭建，说实话一开始真不如直接搬运别人的配置，然后倒过来学习。但是我属于那种不弄清楚不罢休，然后过段时间全部忘记的人，这样通常就是在浪费时间。当然最后我还是配置完成了，只是时间浪费的可不是一星半点，所以真心推荐，**新手小白还是先搬运好的配置，稍微熟练之后再尝试自己配置**。

环境搭建完毕，就要开始写代码了，写代码途中我发现，之前声明了如下的类型：

```ts
export type PropertyKey = string | undefined | null
```

因为我需要使用这种类型，结果无意间看到 TS 内置了一个叫做 `PropertyKey` 的类型接口，这就很尴尬了。等于我重复定义了，而且它定义的比我准确多了，有人可能会说你不会去参考看下 `lib.dom` 库啊，可是关键如果一个新手来做，他知道这个库吗？

这是写类型遇到的第一个问题：**内置类型/接口不知道如何寻找**。

当然第一个问题对于我来说还是很好解决的，那么第二个问题就有些复杂，就是我写了一个公共的回调函数，在 TS 中因为不同的接口实现都定义了一套自己的回调类型，结果就是我写的这个方法不停的在转化类型（目前也是这么做的，应该可以优化）。于是我就想到能不能根据谁使用，那么根据使用者来推断类型。答案自然是有的，毕竟我是个后来者，在网络上的列子中我知道了 `extends` 和 `infer` 关键字，说真的，至少当时我激动了，有解决方案。可以网络上说的真的太基础，或者官网示例，虽然看了很多，但是说清楚的没几个，至于到现在我对这个 `infer` 只有特定环境才可以明白如何写，接口就是我依旧没有找到方法去实现我的想法（有一篇[文章](https://my.oschina.net/u/4318809/blog/4293100) 我个人觉着讲的还行，因为不是盲目的粘贴复制）。这是我遇到的第二个问题：**如何编写高校的检测类型**。

遇到的第三个就是关于 eslint，我使用的是官方团队产品 `@typescript-eslint/eslint-plugin`，可以说提示的还不错，但是每次在写到 JS 中的 `object` 类型我就是很纠结，因为推荐我使用 `Record` 类型，我也听话，调整后发现 option 对象不能被 `Record` 类型兼容，明明定义的 option 类型就是 `Record<string, unknown>`，为什么还是提示错误呢，后来我换成了 `object` 类型就可以。目前而言，关于对象的表示依旧不是很清楚怎么写，是写`Object`，还是`object`，还是`Record`，虽然`eslint`推荐使用`Record`，但是对于小白来说，真的迷糊了。这只是我举得一个列子，其实就是想说我遇到的第三个问题：**到底应该如何使用合理的类型**。

~~那么第四个问题，我需要向原始对象 `HTMLElement` 添加属性，但是 TS 提示不可以，我也能理解，所以为了不污染原始对象，我重新声明了一个新类型：`IDomNode`，它继承了HTMLElement，写到最后都是没有问题的，但是测试调用时提示，不可传入 `HTMLElement`，因为 `HTMLElement` 没有 `IDomNode` 上的一些属性，关键这个 `IDomNode` 又不是一上来就有，难道需要自己再写个方法将每一个 `HTMLElement` 初始化成 `IDomNode`，最后我先使用了折中办法，将所有的`IDomNode` 类的属性变成可选，这就导致只要是使用到 `IDomNode` 的属性需要先判空，虽然可以肯定他们存在，但是 TS 不信他们是存在的。所以我又写了一堆方法判空，感觉显得很多余。~~ 果然使用方式不对，应该是拿到 `HTMLElement`，内部转化成 `IDomNode` 类型即可。

网络上很多做对比的文章，当然都不及自己尝试写写 **Type**Script，它正如字面意思，就是为了检查类型的，可能很严格，但是真的很有用。不过就目前而言，以我的水平，TS 更多像枷锁一样，可能是我习惯 JS 太久了，还有很长的路要走。
