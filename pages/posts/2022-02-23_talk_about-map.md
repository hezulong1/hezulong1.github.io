---
title: åšäº†å‡ ä¸ªæœˆçš„åœ°å›¾ï¼Œåæ§½å‘æ³„ä¸‹
date: 2022-02-23
duration: 5åˆ†é’Ÿ
subtitle: æ–‡ç« é¦–å‘äº 2021/06/15ï¼Œè¿™é‡Œåªæ˜¯è¿ç§»
tag: æ—§
type: talk
---

> ä¸çŸ¥é“æ€ä¹ˆæ’ç‰ˆå¸ƒå±€äº†ï¼Œå‡‘åˆç€çœ‹å§ï¼Œä¸»è¦è‡ªå·±ç”¨

ç ”ç©¶åœ°å›¾æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œèµ„æ–™çœ‹äº†ä¸€å †ä¸€å †çš„ï¼Œå„å®¶ä¹Ÿéƒ½æœ‰è‡ªå·±çš„é£æ ¼ã€‚å› ä¸ºéœ€è¦æ‰¾é€‚åˆå…¬å¸çš„åœ°å›¾æœåŠ¡ï¼Œä»¥å¾€çš„ç™¾åº¦/é«˜å¾·åœ°å›¾å®Œå…¨ä¸åˆé€‚ï¼Œæ‰€ä»¥éœ€è¦å¦å¯»å‡ºè·¯ã€‚

å…¬å¸è¦æ±‚ï¼š

- å…¼å®¹å¤©åœ°å›¾ï¼ˆé¦–è¦ï¼‰
- åŠ è½½ä¸€äº› 3D æ¨¡å‹ï¼ˆæ¬¡è¦ï¼‰
- æœ€å¥½å…¼å®¹å€¾æ–œæ‘„å½±

å…¶å®ç ”ç©¶è¿‡åœ°å›¾çš„éƒ½çŸ¥é“ï¼ŒåŸºæœ¬é [`cesium`](https://cesium.com/platform/cesiumjs/) è«å±ï¼Œä½†æ˜¯ç ”ç©¶2ä¸ªæœˆï¼Œdemo ä¾‹å­ä¹Ÿåšäº†ä¸€äº›ï¼Œé™¤äº†ä¸€äº›ç®€å•çš„ï¼Œä½†å‡¡éœ€è¦é…·ç‚«çš„æ•ˆæœï¼Œç€å®æ— ä»ä¸‹æ‰‹ã€‚åŠ ä¹‹ cesium æ–‡æ¡£å®åœ¨æ˜¯è€ä¸ä½æ€§å­çœ‹ä¸‹å»ï¼Œæœ€ç»ˆæˆ‘æ˜¯æ”¾å¼ƒäº†ã€‚

ä½†æ˜¯å…¬å¸çš„ä¸šåŠ¡æ˜¯è¦è¿›è¡Œä¸‹å»çš„ï¼Œé€€è€Œæ±‚å…¶æ¬¡ï¼Œæˆ‘æ‰“ç®—é‡æ–°æ‰¾ä¸€æ¬¾åœ°å›¾å¤„ç†æ–¹æ¡ˆï¼š

- **å¤©åœ°å›¾è‡ªèº«**ï¼šåŸºç¡€ä½¿ç”¨è¿˜è¡Œï¼Œä½†æ˜¯ä¸€æ—¦æ·±å…¥äº†è§£ï¼ŒçœŸçš„ä¸çŸ¥é“æ€ä¹ˆåŠï¼Œæºç è¢«å‹ç¼©åŠ å¯†ï¼Œæ–‡æ¡£å†™çš„ä¹Ÿæ˜¯éšå¿ƒæ‰€æ¬²ï¼Œæ ·å¼ä¸»é¢˜å°‘çš„å¯æ€œï¼Œ
- **Mapbox**ï¼šçœ‹åˆ°ä»‹ç»ï¼ŒçœŸçš„éå¸¸ç‚«é…·ï¼ŒåŠ ä¹‹ api ç®€å•ï¼Œä¸”å®šåˆ¶åŒ–ç‰¹åˆ«é«˜ï¼Œä¸`three.js`ï¼Œ`d3.js`å¯ä»¥å¾ˆå¥½çš„ç»“åˆï¼Œå”¯ä¸€å°´å°¬çš„å°±æ˜¯åæ ‡ç³»ä»…ä»…æ”¯æŒå¢¨å¡æ‰˜ã€‚å…¶å®ï¼Œæˆ‘ä¹Ÿæ‰¾åˆ°äº†ç›¸å…³çš„è§£å†³æ–¹æ¡ˆã€‚å³å…¼å®¹å„ç±»åæ ‡ç³»ï¼Œ[`cgcs2000/mapbox-gl-js`](https://github.com/cgcs2000/mapbox-gl-js)ï¼Œä½†æ˜¯æ„Ÿè§‰é‚£åªæ˜¯æŠ«ç€`mapbox`çš„å¦ä¸€ä¸ªgis å¤„ç†å·¥å…·ã€‚
- **Leaflet**ï¼šå’Œ **Mapbox** ä¸€å®¶å­çš„ï¼Œapi ä¹Ÿé«˜åº¦ç±»ä¼¼ï¼Œé‡Œé¢çš„æ’ä»¶å¾ˆå¤šï¼Œç›®å‰æˆ‘æ‰¾åˆ°2ä¸ªï¼Œ`leaflet.chinatmsproviders` å’Œ `esri-leaflet`ï¼Œä½†æ˜¯å¯¹æˆ‘æ¥è¯´å¹¶æ²¡æœ‰å•¥ç”¨ï¼Œä»£ç çœ‹äº†ä¸‹ï¼Œæ„Ÿè§‰å¾ˆå‰å®³çš„æ ·å­ã€‚

æ¯•ç«Ÿä¸æ˜¯ä¸“ä¸š GIS äººå£«ï¼Œè€Œè¿™ç©æ„è¦æƒ³ç©çš„æºœï¼Œè¿˜å¾—è¦èŠ±å¤§é‡çš„æ—¶é—´åœ¨ä¸Šé¢ï¼Œç›®å‰æˆ‘ä¹Ÿæ˜¯åœ¨ä¸åœçš„æ‘¸ç´¢ä¸­

## Leaflet åŠ è½½ç»çº¬åº¦æŠ•å½±çš„å¤©åœ°å›¾

> è¿™é‡Œè®°å½•ç»çº¬åº¦æŠ•å½±çš„å¤©åœ°å›¾ä»£ç ï¼Œä»¥ä¾¿ä»¥åä½¿ç”¨
> å¢¨å¡æ‰˜æŠ•å½±çš„ç½‘ä¸Šä¸€å¤§å †ï¼Œè‡ªå·±æ‰¾ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯å»ºè®®ç›´æ¥ä½¿ç”¨ mapboxï¼Œå› ä¸ºé‚£æ˜¯çœŸçš„å¥½çœ‹å•ŠğŸ˜„

```javascript
import L from 'leaflet'

function object2params(o) {
  let ret = ''
  for (const k in o) {
    if (typeof o[k] === 'string') {
      ret += `&${ k }=${ o[k] }`
    }
  }
  return ret.replace(/&/, '?')
}

const generateTDBaseConfig = layer => object2params({
  SERVICE: 'WMTS',
  REQUEST: 'GetTile',
  VERSION: '1.0.0',
  STYLE: 'default',
  FORMAT: 'tiles',
  TILEMATRIXSET: 'c', // æ³¨æ„è¿™é‡Œè°ƒæ•´ä¸º cï¼Œä¸æ˜¯ w
  TILEMATRIX: '{z}',
  TILEROW: '{y}',
  TILECOL: '{x}',
  LAYER: layer,
  tk: 'you token'
})

const tdtVectorMap = 'http://t{s}.tianditu.gov.cn/vec_c/wmts' + generateTDBaseConfig('vec')
const tdtVectorLabel = 'http://t{s}.tianditu.gov.cn/cva_c/wmts' + generateTDBaseConfig('cva')

const layerOptions = {
  maxZoom: 18,
  minZoom: 1,
  zoomOffset: 1,
  subdomains: [ '0', '1', '2', '3', '4', '5', '6', '7' ]
}

const normalm = L.tileLayer(tdtVectorMap, layerOptions)
const normala = L.tileLayer(tdtVectorLabel, layerOptions)

const thirdLayer = L.tileLayer('you EPSG4326 server url', {
  zoomOffset: 1 // æ³¨æ„è¿™é‡Œå’Œä¸Šé¢çš„ layerOptions ä¿æŒä¸€è‡´ï¼Œåˆæ˜¯ä¸ªå‘çš„åœ°æ–¹
})

const normal = L.layerGroup([ normalm, thirdLayer, normala ]) // æ³¨æ„è¿™é‡Œçš„æ’åºï¼Œè¶Šé å‰è¶Šåœ¨åœ°å›¾åº•å±‚

const map = L.map('you dom', {
  center: [0, 0], // è°ƒæ•´æˆè‡ªå·±éœ€è¦çš„ä¸­å¿ƒç‚¹
  zoom: 9,
  layers: [ normal ],
  crs: L.CRS.EPSG4326 // ä¸€å®šè¦è®¾ç½®
})
```

---

2021-06-15: åç»­åœ¨è¡¥å……å§
